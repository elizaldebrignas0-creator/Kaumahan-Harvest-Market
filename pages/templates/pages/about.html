{% extends 'base.html' %}
{% load static %}

{% block title %}About - Kaumahan Harvest Market{% endblock %}

{% block extra_css %}
<style>
    /* Custom styles for About page */
    .about-hero {
        padding: 0;
        background-color: #fff;
        position: relative;
        overflow: hidden;
    }
    
    .banner-carousel {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 20px;
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        background: #fff;
    }
    
    .banner-slides {
        display: flex;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        width: 100%;
        height: 400px; /* Standard height */
    }
    
    .banner-slide {
        min-width: 100%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
    }
    
    .banner-slide img {
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
        display: block;
        margin: 0 auto;
        object-fit: contain;
    }
    
    .video-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
    }
    
    .banner-slide video {
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
        display: block;
        object-fit: contain;
    }
    
    .banner-slide .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        padding: 2rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .banner-slide .logo-container img {
        max-width: 80%;
        max-height: 80%;
        width: auto;
        height: auto;
        object-fit: contain;
    }
    
    .banner-slide .logo-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    
    .banner-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: #fff;
        padding: 2rem;
    }
    
    .banner-title {
        font-family: 'Poppins', sans-serif;
        font-size: 3.5rem;
        font-weight: 700;
        color: #2E7D32;
        margin-bottom: 1rem;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    .banner-subtitle {
        font-family: 'Poppins', sans-serif;
        font-size: 1.5rem;
        color: #333;
        margin-bottom: 2rem;
        position: relative;
        display: inline-block;
    }
    
    .banner-subtitle::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background-color: #FF8C00;
    }
    
    .banner-features {
        display: flex;
        gap: 2rem;
        margin: 2rem 0;
    }
    
    .feature-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family: 'Poppins', sans-serif;
        font-size: 1.2rem;
        color: #2E7D32;
        font-weight: 500;
    }
    
    .feature-item i {
        color: #FF8C00;
    }
    
    .contact-bar {
        background-color: #FF8C00;
        color: white;
        padding: 1rem 0;
        font-family: 'Poppins', sans-serif;
        font-size: 1.1rem;
        text-align: center;
        margin-top: -5px;
    }
    
    .carousel-control {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        color: #2E7D32;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        opacity: 0;
    }
    
    .banner-carousel:hover .carousel-control {
        opacity: 1;
    }
    
    .carousel-control i {
        font-size: 1.5rem;
        transition: transform 0.2s ease;
    }
    
    .carousel-control:hover {
        background: #fff;
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .carousel-control:active {
        transform: translateY(-50%) scale(0.95);
    }
    
    .carousel-prev {
        left: 25px;
    }
    
    .carousel-next {
        right: 25px;
    }
    
    .carousel-indicators {
        position: absolute;
        bottom: 25px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 12px;
        z-index: 10;
        padding: 8px 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 20px;
        width: fit-content;
        margin: 0 auto;
        backdrop-filter: blur(5px);
    }
    
    .carousel-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        padding: 0;
        margin: 0;
    }
    
    .carousel-indicator:hover {
        background-color: rgba(255, 255, 255, 0.8);
        transform: scale(1.2);
    }
    
    .carousel-indicator.active {
        background-color: #FF8C00;
        transform: scale(1.3);
        border-color: white;
        width: 30px;
        border-radius: 5px;
    }
    
    .carousel-container {
        height: 400px;
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        margin: 2rem 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .carousel-slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #fff;
    }
    
    .carousel-slide.active {
        opacity: 1;
    }
    
    .carousel-slide img, .carousel-slide video {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }
    
    .about-content {
        padding: 3rem 0;
    }
    
    .about-text {
        max-width: 800px;
        margin: 0 auto 2rem;
        line-height: 1.8;
        color: #333;
    }
    
    .highlight {
        color: #4CAF50;
        font-weight: 600;
    }
    
    @media (max-width: 768px) {
        .carousel-container {
            height: 300px;
        }
        
        .banner-carousel {
            margin: 1rem auto !important;
            padding: 15px !important;
        }
        
        .banner-slides {
            height: 300px !important;
        }
        
        .banner-title {
            font-size: 2.5rem !important;
        }
        
        .banner-subtitle {
            font-size: 1.3rem !important;
        }
        
        .carousel-control {
            width: 45px !important;
            height: 45px !important;
        }
        
        .carousel-prev {
            left: 15px !important;
        }
        
        .carousel-next {
            right: 15px !important;
        }
        
        .about-logo {
            max-width: 180px;
        }
        
        .contact-bar {
            font-size: 0.9rem !important;
            padding: 0.75rem 0 !important;
        }
    }
    
    @media (max-width: 576px) {
        .banner-carousel {
            margin: 0.5rem auto !important;
            padding: 10px !important;
        }
        
        .banner-slides {
            height: 250px !important;
        }
        
        .banner-title {
            font-size: 2rem !important;
        }
        
        .banner-subtitle {
            font-size: 1.1rem !important;
        }
        
        .carousel-control {
            width: 40px !important;
            height: 40px !important;
        }
        
        .carousel-prev {
            left: 10px !important;
        }
        
        .carousel-next {
            right: 10px !important;
        }
        
        .carousel-control i {
            font-size: 1.2rem !important;
        }
        
        .carousel-indicators {
            bottom: 15px !important;
            padding: 6px 12px !important;
            gap: 8px !important;
        }
        
        .carousel-indicator {
            width: 8px !important;
            height: 8px !important;
        }
        
        .carousel-indicator.active {
            width: 20px !important;
        }
        
        .contact-bar {
            font-size: 0.8rem !important;
            padding: 0.5rem 0 !important;
        }
        
        .about-text {
            font-size: 0.95rem !important;
        }
    }
    
    /* Animation classes */
    .fade-in {
        animation: fadeIn 1.5s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .delay-1 { animation-delay: 0.3s; }
    .delay-2 { animation-delay: 0.6s; }
    .delay-3 { animation-delay: 0.9s; }
</style>
{% endblock %}

{% block content %}
<section class="about-hero">
    <div class="banner-carousel">
        <div class="banner-slides">
            <!-- Slide 1: Logo -->
            <div class="banner-slide">
                <div class="logo-container">
                    <img src="{% static 'img/aboutuslogo.png' %}" alt="Kaumahan Harvest Market Logo">
                </div>
            </div>
            
            <!-- Slide 2: Banner -->
            <div class="banner-slide">
                <img src="{% static 'img/banner.png' %}" alt="Kaumahan Harvest Market Banner" style="max-height: 400px;">
                <div class="banner-overlay">
                    
                    <div class="banner-features">
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                           
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 3: Video -->
            <div class="banner-slide">
                <div class="video-container">
                    <div style="width: 100%; height: 100%; background: #000; display: flex; align-items: center; justify-content: center; position: relative;">
                        <!-- Primary video element with comprehensive attributes -->
                        <video 
                            id="advertisementVideo" 
                            controls
                            preload="auto" 
                            playsinline
                            muted
                            loop
                            style="width: 100%; height: 100%; object-fit: contain; background: #000;"
                            poster="{% static 'img/banner.png' %}"
                            onerror="handleVideoError(this)"
                            onloadstart="console.log('Video load started')"
                            onloadedmetadata="console.log('Video metadata loaded')"
                            onloadeddata="console.log('Video data loaded')"
                            oncanplay="console.log('Video can play')"
                            oncanplaythrough="console.log('Video can play through')"
                            onplay="console.log('Video playing')"
                            onpause="console.log('Video paused')"
                            onended="console.log('Video ended')"
                        >
                            <source src="{% static 'img/advertisement.mp4' %}" type="video/mp4">
                            <source src="{% static 'img/advertisement.webm' %}" type="video/webm">
                            <source src="{% static 'img/advertisement.ogg' %}" type="video/ogg">
                            Your browser does not support the video tag.
                            <div style="padding: 20px; color: white; text-align: center;">
                                <h3>Video Not Supported</h3>
                                <p>Your browser doesn't support this video format.</p>
                                <a href="{% static 'img/advertisement.mp4' %}" target="_blank" style="color: #4CAF50;">Watch Video</a>
                            </div>
                        </video>
                        
                        <!-- Enhanced fallback interface -->
                        <div id="videoFallback" style="display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border-radius: 8px;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">ðŸŽ¬</div>
                            <h3 style="margin-bottom: 15px; font-weight: 600;">Advertisement Video</h3>
                            <p style="margin-bottom: 20px; opacity: 0.9;">Learn more about Kaumahan Harvest Market!</p>
                            
                            <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-bottom: 15px;">
                                <a href="{% static 'img/advertisement.mp4' %}" target="_blank" 
                                   style="background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.background='#218838'; this.style.transform='translateY(-2px)';"
                                   onmouseout="this.style.background='#28a745'; this.style.transform='translateY(0)';">
                                    <span>ðŸ“¹</span> Watch Video
                                </a>
                                <a href="{% static 'img/advertisement.mp4' %}" download 
                                   style="background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.background='#0056b3'; this.style.transform='translateY(-2px)';"
                                   onmouseout="this.style.background='#007bff'; this.style.transform='translateY(0)';">
                                    <span>ðŸ’¾</span> Download
                                </a>
                            </div>
                            
                            <button onclick="retryVideo()" 
                                    style="background: #6c757d; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; transition: all 0.3s ease;"
                                    onmouseover="this.style.background='#5a6268';"
                                    onmouseout="this.style.background='#6c757d';">
                                ðŸ”„ Retry Video
                            </button>
                            
                            <p style="margin-top: 15px; font-size: 12px; opacity: 0.7;">
                                If the video doesn't play, use the options above
                            </p>
                        </div>
                    </div>
                </div>
                <div class="banner-overlay" style="background: rgba(0, 0, 0, 0.3);">
                    
        
                </div>
            </div>
        </div>
        
        <!-- Navigation Controls -->
        <button class="carousel-control carousel-prev" aria-label="Previous slide">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-control carousel-next" aria-label="Next slide">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <!-- Indicators -->
        <div class="carousel-indicators">
            <button class="carousel-indicator active" data-slide="0" aria-label="Go to logo"></button>
            <button class="carousel-indicator" data-slide="1" aria-label="Go to banner"></button>
            <button class="carousel-indicator" data-slide="2" aria-label="Go to video"></button>
        </div>
    </div>
    
    <div class="contact-bar">
        CONTACT 09602223575 â€¢ P.I GARCIA NAVAL, BILIRAN
    </div>
</section>

<!-- About Content Section -->
<section class="about-content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="about-text fade-in delay-1">
                    <p class="lead"><span class="highlight">Kaumahan Harvest Market</span> is built to connect local farmers and buyers by providing fresh, natural, and locally sourced produce. Our mission is to support local agriculture, promote healthier food choices, and empower communities through fair and sustainable trade.</p>
                    
                    <p class="mt-4">Through our platform, sellers can easily showcase their harvest, while buyers enjoy convenient access to high-quality farm products. We aim to make farm-to-table simpler, faster, and more transparentâ€”helping everyone live healthier and support local growers.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.querySelector('.banner-carousel');
        const slidesContainer = document.querySelector('.banner-slides');
        const slides = document.querySelectorAll('.banner-slide');
        const prevBtn = document.querySelector('.carousel-prev');
        const nextBtn = document.querySelector('.carousel-next');
        const indicators = document.querySelectorAll('.carousel-indicator');
        
        let currentSlide = 0;
        const totalSlides = slides.length;
        let slideInterval;
        
        // Set initial slide position
        function updateSlidePosition() {
            slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
            updateIndicators();
        }
        
        // Update active indicator
        function updateIndicators() {
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlide);
            });
        }
        
        // Go to specific slide
        function goToSlide(index) {
            if (index < 0) {
                currentSlide = totalSlides - 1;
            } else if (index >= totalSlides) {
                currentSlide = 0;
            } else {
                currentSlide = index;
            }
            updateSlidePosition();
        }
        
        // Next slide
        function nextSlide() {
            goToSlide(currentSlide + 1);
            resetInterval();
        }
        
        // Previous slide
        function prevSlide() {
            goToSlide(currentSlide - 1);
            resetInterval();
        }
        
        // Auto slide
        function startInterval() {
            stopInterval();
            slideInterval = setInterval(nextSlide, 5000);
        }
        
        function stopInterval() {
            clearInterval(slideInterval);
        }
        
        function resetInterval() {
            stopInterval();
            startInterval();
        }
        
        // Event Listeners
        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);
        
        // Indicator click
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                goToSlide(index);
                resetInterval();
            });
        });
        
        // Pause on hover
        carousel.addEventListener('mouseenter', stopInterval);
        carousel.addEventListener('mouseleave', startInterval);
        
        // Touch events for mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        carousel.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            stopInterval();
        }, { passive: true });
        
        carousel.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].clientX;
            handleSwipe();
            resetInterval();
        }, { passive: true });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const difference = touchStartX - touchEndX;
            
            if (Math.abs(difference) > swipeThreshold) {
                if (difference > 0) {
                    nextSlide();
                } else {
                    prevSlide();
                }
            }
        }
        
        // Initialize carousel
        updateSlidePosition();
        startInterval();
        
        // Video initialization and comprehensive error handling
        const video = document.getElementById('advertisementVideo');
        if (video) {
            console.log('ðŸŽ¬ Video element found, initializing comprehensive player...');
            
            // Add event listeners for debugging and error handling
            video.addEventListener('loadstart', () => {
                console.log('ðŸ“¹ Video loading started');
                hideFallback();
            });
            
            video.addEventListener('loadedmetadata', () => {
                console.log('ðŸ“¹ Video metadata loaded');
                console.log(`ðŸ“ Dimensions: ${video.videoWidth}x${video.videoHeight}`);
                console.log(`â±ï¸  Duration: ${video.duration} seconds`);
            });
            
            video.addEventListener('loadeddata', () => {
                console.log('ðŸ“¹ Video data loaded successfully');
            });
            
            video.addEventListener('canplay', () => {
                console.log('ðŸ“¹ Video can play - ready for user interaction');
            });
            
            video.addEventListener('canplaythrough', () => {
                console.log('ðŸ“¹ Video can play through - fully loaded');
            });
            
            video.addEventListener('play', () => {
                console.log('ðŸ“¹ Video playing');
                // Pause carousel when video plays
                stopInterval();
            });
            
            video.addEventListener('pause', () => {
                console.log('ðŸ“¹ Video paused');
                // Resume carousel when video pauses
                startInterval();
            });
            
            video.addEventListener('ended', () => {
                console.log('ðŸ“¹ Video ended');
                // Resume carousel when video ends
                startInterval();
            });
            
            video.addEventListener('error', (e) => {
                console.error('ðŸ“¹ Video error occurred:', e);
                console.error('ðŸ“¹ Error code:', video.error ? video.error.code : 'Unknown');
                console.error('ðŸ“¹ Error message:', video.error ? video.error.message : 'No message');
                handleVideoError(video);
            });
            
            video.addEventListener('stalled', () => {
                console.warn('ðŸ“¹ Video stalled - network issue');
            });
            
            video.addEventListener('waiting', () => {
                console.log('ðŸ“¹ Video waiting for data');
            });
            
            // Check video state after initialization
            setTimeout(() => {
                if (video.readyState === 0) {
                    console.warn('ðŸ“¹ Video not loaded after 3 seconds - showing fallback');
                    handleVideoError(video);
                } else {
                    console.log(`ðŸ“¹ Video ready state: ${video.readyState}`);
                }
            }, 3000);
            
            // Try to load the video
            try {
                video.load();
                console.log('ðŸ“¹ Video load() called successfully');
            } catch (error) {
                console.error('ðŸ“¹ Error calling video.load():', error);
                handleVideoError(video);
            }
        } else {
            console.error('ðŸ“¹ Video element not found!');
        }
        
        // Global video error handler function
        window.handleVideoError = function(videoElement) {
            console.log('ðŸ“¹ Handling video error - showing fallback');
            if (videoElement) {
                videoElement.style.display = 'none';
            }
            const fallback = document.getElementById('videoFallback');
            if (fallback) {
                fallback.style.display = 'flex';
            }
        };
        
        // Global retry video function
        window.retryVideo = function() {
            console.log('ðŸ“¹ Retrying video playback...');
            const video = document.getElementById('advertisementVideo');
            const fallback = document.getElementById('videoFallback');
            
            if (video && fallback) {
                // Hide fallback
                fallback.style.display = 'none';
                // Show video
                video.style.display = 'block';
                // Reload video
                video.load();
                // Try to play after a short delay
                setTimeout(() => {
                    video.play().catch(error => {
                        console.error('ðŸ“¹ Auto-play failed:', error);
                        // Show fallback again if auto-play fails
                        handleVideoError(video);
                    });
                }, 1000);
            }
        };
        
        // Helper function to hide fallback
        function hideFallback() {
            const fallback = document.getElementById('videoFallback');
            if (fallback) {
                fallback.style.display = 'none';
            }
        }
    });
</script>
{% endblock %}
